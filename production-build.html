<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Production build | Scala.js SPA-tutorial</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./faq.html" />
    
    
    <link rel="prev" href="./running-the-server-in-a-separate-jvm.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    <div class="book" data-level="6.5" data-basepath="." data-revision="Thu Apr 02 2015 21:30:06 GMT+0300 (FLE Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="getting-started.html">
            
                
                    <a href="./getting-started.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting started
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="application-structure.html">
            
                
                    <a href="./application-structure.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Application structure
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="the-client.html">
            
                
                    <a href="./the-client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        The Client
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="routing.html">
            
                
                    <a href="./routing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        Routing
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="main-menu.html">
            
                
                    <a href="./main-menu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                        Main menu
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="dashboard.html">
            
                
                    <a href="./dashboard.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                        Dashboard
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="css-in-scala.html">
            
                
                    <a href="./css-in-scala.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                        CSS in Scala
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="integrating-javascript-components.html">
            
                
                    <a href="./integrating-javascript-components.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.5.</b>
                        
                        Integrating JavaScript components
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="todo-module-and-data-flow.html">
            
                
                    <a href="./todo-module-and-data-flow.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.6.</b>
                        
                        Todo module and data flow
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="autowire-and-upickle.html">
            
                
                    <a href="./autowire-and-upickle.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.7.</b>
                        
                        Autowire and uPickle
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="server-side.html">
            
                
                    <a href="./server-side.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Server side
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="testing.html">
            
                
                    <a href="./testing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Testing
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="debugging.html">
            
                
                    <a href="./debugging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Debugging
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="logging.html">
            
                
                    <a href="./logging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Logging
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="sbt-build-definition.html">
            
                
                    <a href="./sbt-build-definition.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SBT build definition
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="serving-compiled-js-from-both-projects.html">
            
                
                    <a href="./serving-compiled-js-from-both-projects.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Serving compiled JS from both projects
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="sharing-web-resources-between-js-and-jvm-projects.html">
            
                
                    <a href="./sharing-web-resources-between-js-and-jvm-projects.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Sharing web resources between JS and JVM projects
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="using-resources-from-webjars.html">
            
                
                    <a href="./using-resources-from-webjars.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Using resources from WebJars
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="running-the-server-in-a-separate-jvm.html">
            
                
                    <a href="./running-the-server-in-a-separate-jvm.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Running the server in a separate JVM
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="6.5" data-path="production-build.html">
            
                
                    <a href="./production-build.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Production build
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="faq.html">
            
                
                    <a href="./faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        FAQ
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="what-next.html">
            
                
                    <a href="./what-next.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        What next?
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">Published with GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Share on Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Share on Google</button>
                <button type="button" data-sharing="facebook" class="button">Share on Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Share on Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Share on Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Scala.js SPA-tutorial</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="production-build">Production build</h1>
<p>So far we have been interested in having a nice and fast development cycle, without worrying about optimization. For your production release you&apos;ll want
to have a very optimized and small code-base to make the application perform well for the end user. To build an optimized version of the application
you just need to use <code>fullOptJS</code> instead of <code>fastOptJS</code>. This will produce a JavaScript file with <code>-opt.js</code> extension, so the server must know to serve
this file instead of the non-optimized version.</p>
<h2 id="configuring-between-development-and-production">Configuring between development and production</h2>
<p>To achieve this, we need to add a configuration parameter that can be affected from outside the application. Typesafe provides a nice
<a href="https://github.com/typesafehub/config" target="_blank">config library</a> for application configuration data so we&apos;ll be using it. The library automatically reads
<code>reference.conf</code> and <code>application.conf</code> (amongst a few others) from resources, so all you need to is to add an <code>application.conf</code> under <code>resources</code>.
Our configuration is extremely simple:</p>
<pre><code class="lang-yaml">spatutorial {
  productionMode = false
  productionMode = ${?PRODUCTION_MODE}
}
</code></pre>
<p>These configs can be overridden by having a separate <code>application.conf</code> in your built application conf-directory, but we are using a system
environment variable to override the single setting. By default <code>productionMode</code> is <code>false</code> but if the env variable <code>PRODUCTION_MODE</code> is set,
it will override the default.</p>
<p><code>MainApp</code> loads this configuration into a <code>Config</code> object.</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Config</span> {</span>
  <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">c</span> =</span> <span class="hljs-type">ConfigFactory</span>.load().getConfig(<span class="hljs-string">&quot;spatutorial&quot;</span>)

  <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">productionMode</span> =</span> c.getBoolean(<span class="hljs-string">&quot;productionMode&quot;</span>)
}
</code></pre>
<p>The <code>productionMode</code> parameter is only used to determine which HTML file to serve.</p>
<pre><code class="lang-scala">  <span class="hljs-keyword">if</span>(<span class="hljs-type">Config</span>.productionMode)
    getFromResource(<span class="hljs-string">&quot;web/index-full.html&quot;</span>)
  <span class="hljs-keyword">else</span>
    getFromResource(<span class="hljs-string">&quot;web/index.html&quot;</span>)
</code></pre>
<h2 id="using-optimized-versions-of-js-libraries">Using optimized versions of JS libraries</h2>
<p>Typically JS libraries provided in WebJars come in two variants: normal and minified (<code>.min.js</code>). The latter is highly compressed and often also optimized
version of the more verbose normal version. For example debug-prints and development time checks have been removed. Therefore it makes sense to use these
pre-packaged minified versions instead of running the minification process yourself.</p>
<p>We need to define a separate list of JS dependencies for the production build, using the <code>.min.js</code> versions:</p>
<pre><code class="lang-scala"><span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">jsDependenciesProduction</span> =</span> <span class="hljs-type">Def</span>.setting(<span class="hljs-type">Seq</span>(
  <span class="hljs-string">&quot;org.webjars&quot;</span> % <span class="hljs-string">&quot;react&quot;</span> % versions.react / <span class="hljs-string">&quot;react-with-addons.min.js&quot;</span> commonJSName <span class="hljs-string">&quot;React&quot;</span>,
  <span class="hljs-string">&quot;org.webjars&quot;</span> % <span class="hljs-string">&quot;jquery&quot;</span> % versions.jQuery / <span class="hljs-string">&quot;jquery.min.js&quot;</span>,
  <span class="hljs-string">&quot;org.webjars&quot;</span> % <span class="hljs-string">&quot;bootstrap&quot;</span> % versions.bootstrap / <span class="hljs-string">&quot;bootstrap.min.js&quot;</span> dependsOn <span class="hljs-string">&quot;jquery.min.js&quot;</span>,
  <span class="hljs-string">&quot;org.webjars&quot;</span> % <span class="hljs-string">&quot;chartjs&quot;</span> % versions.chartjs / <span class="hljs-string">&quot;Chart.min.js&quot;</span>,
  <span class="hljs-string">&quot;org.webjars&quot;</span> % <span class="hljs-string">&quot;log4javascript&quot;</span> % versions.log4js / <span class="hljs-string">&quot;js/log4javascript.js&quot;</span>
))
</code></pre>
<p>Because packaging the JS libs is a different task in SBT (it doesn&apos;t relate to <code>fastOptJS</code> or <code>fullOptJS</code>) we need another way to tell SBT to use these
dependencies instead of the normal ones. For that we&apos;ll define a <code>settingKey</code></p>
<pre><code class="lang-scala">  <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">productionBuild</span> =</span> settingKey[<span class="hljs-type">Boolean</span>](<span class="hljs-string">&quot;Build for production&quot;</span>)
</code></pre>
<p>and set it in the JS project</p>
<pre><code class="lang-scala">.jsSettings(
  productionBuild := <span class="hljs-literal">false</span>,
  jsDependencies ++= {<span class="hljs-keyword">if</span> (!productionBuild.value) <span class="hljs-type">Settings</span>.jsDependencies.value <span class="hljs-keyword">else</span> <span class="hljs-type">Settings</span>.jsDependenciesProduction.value},
</code></pre>
<p>To do a production build, you&apos;ll need to override the setting on SBT command line:</p>
<pre><code>set productionBuild in js := true
</code></pre><p>If you now run <code>packageJSDependencies</code> it will use the minified versions and build a smaller <code>-jsdeps.js</code> file.</p>
<h2 id="packaging-an-application">Packaging an application</h2>
<p>Running your app from SBT is fine for development but not so great in production. To build an application package with all the JAR libraries included,
we can use the <a href="https://github.com/sbt/sbt-native-packager" target="_blank"><code>sbt-native-packager</code></a> plugin.</p>
<pre><code class="lang-scala"><span class="hljs-comment">// in plugins.sbt</span>
addSbtPlugin(<span class="hljs-string">&quot;com.typesafe.sbt&quot;</span> % <span class="hljs-string">&quot;sbt-native-packager&quot;</span> % <span class="hljs-string">&quot;1.0.0-RC1&quot;</span>)

<span class="hljs-comment">// in build.scala</span>
jvm.enablePlugins(<span class="hljs-type">JavaAppPackaging</span>)
</code></pre>
<p>This is all you need to enable the <code>stage</code> command in SBT (under the JVM project), which will build and package the application for you in the
<code>target/universal/stage</code> directory. You may run the application with <code>bin/scalajs-spa</code> (or <code>bin\scalajs-spa.bat</code> in Windows).</p>
<p>We can configure the packager to set the <code>PRODUCTION_BUILD</code> environment variable automatically in the script with the following settings</p>
<pre><code class="lang-scala"><span class="hljs-type">NativePackagerKeys</span>.batScriptExtraDefines += <span class="hljs-string">&quot;set PRODUCTION_MODE=true&quot;</span>,
<span class="hljs-type">NativePackagerKeys</span>.bashScriptExtraDefines += <span class="hljs-string">&quot;export PRODUCTION_MODE=true&quot;</span>,
</code></pre>
<h2 id="automating-the-release-build">Automating the release build</h2>
<p>Even though we have all the pieces to build and package the application, it can be quite tedious to run several SBT commands one after another
to get everything done. That&apos;s what computers are really good at, so let&apos;s build a special <code>Command</code> to do the release.</p>
<pre><code class="lang-scala"><span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">ReleaseCmd</span> =</span> <span class="hljs-type">Command</span>.command(<span class="hljs-string">&quot;release&quot;</span>) {
  state =&gt; <span class="hljs-string">&quot;set productionBuild in js := true&quot;</span> ::
    <span class="hljs-string">&quot;set elideOptions in js := Seq(\&quot;-Xelide-below\&quot;, \&quot;WARNING\&quot;)&quot;</span> ::
    <span class="hljs-string">&quot;sharedProjectJS/test&quot;</span> ::
    <span class="hljs-string">&quot;sharedProjectJS/fullOptJS&quot;</span> ::
    <span class="hljs-string">&quot;sharedProjectJS/packageJSDependencies&quot;</span> ::
    <span class="hljs-string">&quot;sharedProjectJVM/test&quot;</span> ::
    <span class="hljs-string">&quot;sharedProjectJVM/stage&quot;</span> ::
    <span class="hljs-string">&quot;set productionBuild in js := false&quot;</span> ::
    <span class="hljs-string">&quot;set elideOptions in js := Seq()&quot;</span> ::
    state
}
</code></pre>
<p>and enable it in the root project</p>
<pre><code class="lang-scala">  commands += <span class="hljs-type">ReleaseCmd</span>,
</code></pre>
<p>With this command, you can just execute <code>release</code> under the <code>root</code> and SBT will run all those individual commands to build
your application package.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./running-the-server-in-a-separate-jvm.html" class="navigation navigation-prev " aria-label="Previous page: Running the server in a separate JVM"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./faq.html" class="navigation navigation-next " aria-label="Next page: FAQ"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
